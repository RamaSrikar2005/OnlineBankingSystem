<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transaction History</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- ðŸ”’ Page protection -->
    <script>
        if (!localStorage.getItem("user_id")) {
            window.location.replace("/login");
        }
    </script>
</head>

<body class="login-bg">

<div class="form-container">
    <h1>Transaction History</h1>

    <input
        type="number"
        id="account_id"
        placeholder="Enter Account ID"
        required
    >

    <button onclick="getTransactions()">View Transactions</button>

    <div id="transactions" style="margin-top:15px;"></div>

    <button onclick="window.location.href='/dashboard'">
        Back to Dashboard
    </button>
</div>

<script>
function getTransactions() {
    const accountId = document.getElementById("account_id").value;
    const container = document.getElementById("transactions");

    container.innerHTML = "";

    if (!accountId) {
        container.innerHTML = "<p>Please enter Account ID</p>";
        return;
    }

    fetch(`/api/account/${accountId}/transactions`, {
        method: "GET",
        credentials: "same-origin"   // âœ… THIS IS THE FIX
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            container.innerHTML = `<p>${data.error}</p>`;
            return;
        }

        if (!data.transactions || data.transactions.length === 0) {
            container.innerHTML = "<p>No transactions found</p>";
            return;
        }

        data.transactions.forEach(tx => {
            container.innerHTML += `
                <div class="account-box">
                    <strong>${tx.transaction_type.toUpperCase()}</strong><br>
                    Amount: â‚¹${tx.amount}<br>
                    Date & Time: ${tx.created_at}
                </div>
            `;
        });
    })
    .catch(() => {
        container.innerHTML = "<p>Server error</p>";
    });
}
</script>

</body>
</html>
